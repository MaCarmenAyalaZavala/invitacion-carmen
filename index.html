<!-- Archivo: invitacion-carmen-ayala.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Invitación 70 Años Carmen Ayala</title>
  <meta name="description" content="Invitación a los 70 años de Maria del Carmen Ayala Zavala. Acompáñame a celebrar esta ocasión especial." />
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/892/892458.png" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet" />
  <style>
    /* ... (se mantiene todo tu CSS original sin cambios) ... */
  </style>
</head>
<body>
  <div class="invitation-container">
    <!-- ... tu contenido de invitación sin cambios ... -->

    <button class="confirm-button" onclick="openModal()">Confirma asistencia</button>
  </div>

  <div id="rsvpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal()" aria-label="Cerrar modal">&times;</button>
      <div class="modal-title" id="modalTitle">Confirma tu asistencia</div>
      <form id="rsvpForm">
        <div class="form-group">
          <label class="form-label" for="name">Nombre(s) y apellido(s):</label>
          <input type="text" id="name" required aria-label="Nombre completo" />
        </div>
        <div class="form-group">
          <label class="form-label" for="adults">Número de personas:</label>
          <input type="number" id="adults" min="1" max="2" value="1" required aria-label="Número de personas" />
          <div id="errorMessage" style="color: #b00020; font-size: 13px; margin-top: -10px; margin-bottom: 10px; display: none;"></div>
        </div>
        <button type="submit" class="submit-btn">Enviar confirmación</button>
        <div class="loading-spinner" id="loadingSpinner"></div>
      </form>
      <div id="thankYouMessage" class="success">¡Gracias por confirmar!</div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAG1fFh_ZwN4hSYe-1v-yxqsW4WWjyjkl4",
      authDomain: "confirmaciones-jimena.firebaseapp.com",
      projectId: "confirmaciones-jimena",
      storageBucket: "confirmaciones-jimena.appspot.com",
      messagingSenderId: "669569632299",
      appId: "1:669569632299:web:6d64c8d1f476582817826e",
      measurementId: "G-JY78XDX885",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function openModal() {
      document.getElementById("rsvpModal").classList.add("active");
      document.body.style.overflow = "hidden";
    }

    function closeModal() {
      const modal = document.getElementById("rsvpModal");
      modal.classList.remove("active");
      document.body.style.overflow = "auto";
      setTimeout(() => {
        document.getElementById("thankYouMessage").style.display = "none";
        document.getElementById("rsvpForm").style.display = "block";
        document.getElementById("rsvpForm").reset();
        document.getElementById("adults").value = 1;
        document.getElementById("errorMessage").style.display = "none";
      }, 300);
    }

    document.getElementById("rsvpModal").addEventListener("click", function (e) {
      if (e.target === this) closeModal();
    });

    document.addEventListener('keydown', e => {
      if(e.key === "Escape" && document.getElementById("rsvpModal").classList.contains("active")) {
        closeModal();
      }
    });

    document.getElementById("rsvpForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const adults = parseInt(document.getElementById("adults").value);
      const errorMessage = document.getElementById("errorMessage");
      errorMessage.style.display = "none";

      // Validar nombre
      if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s\-']+$/.test(name)) {
        errorMessage.textContent = "Por favor ingresa un nombre válido.";
        errorMessage.style.display = "block";
        return;
      }

      // Validar límite de personas
      if (adults > 2) {
        errorMessage.textContent = "El número máximo permitido es 2 personas.";
        errorMessage.style.display = "block";
        return;
      }

      document.getElementById("loadingSpinner").style.display = "block";

      db.collection("confirmaciones")
        .add({
          nombre: name,
          adultos: adults,
          fecha: new Date().toLocaleString("es-MX"),
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        })
        .then(() => {
          document.getElementById("rsvpForm").style.display = "none";
          document.getElementById("thankYouMessage").style.display = "block";
          document.getElementById("loadingSpinner").style.display = "none";
          setTimeout(closeModal, 1500);
        })
        .catch((error) => {
          document.getElementById("loadingSpinner").style.display = "none";
          alert("Ocurrió un error al guardar. Intenta nuevamente.");
          console.error("Error al guardar en Firebase:", error);
        });
    });
  </script>

  <footer>
    Versión 1.0.6 - Actualizado: <script>document.write(new Date().toLocaleDateString("es-MX", { year: 'numeric', month: 'long', day: 'numeric' }));</script>
  </footer>
</body>
</html>
