<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Invitación 70 Años — Carmen Ayala</title>
  <meta name="description" content="Invitación para celebrar los 70 años de María del Carmen Ayala Zavala. Ceremonia en Parroquia de San Jacinto y recepción en Comunidad Teológica de México." />
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/892/892458.png" />
  <!-- Fuentes: mantienen Playfair/Parisienne/Montserrat como pediste -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600&family=Parisienne&display=swap" rel="stylesheet" />
  <style>
    :root {
      --color-primario: #0a2d6b;
      --color-secundario: #4a64a6;
      --color-terciario: #f1eae2;
      --color-fondo: #fcf9f3;
      --color-texto: #333b4f;
      --color-texto-claro: #8c96ac;
      --color-borde: #dcd6ce;
      --color-sombra: rgba(10, 45, 107, 0.1);
      --color-boton: #4a64a6;
      --color-boton-hover: #0a2d6b;

      /* layout vars homologadas */
      --max-width: 1000px;
      --container-padding: 18px;
      --focus-ring: rgba(10,45,107,0.12);
    }

    /* reset / accessibility */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html,body { height:100%; }
    body {
      margin:0;
      font-family: 'Montserrat', system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      background-color: var(--color-fondo);
      color: var(--color-texto);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Container homologado */
    .invitation-container {
      max-width: var(--max-width);
      margin: 0 auto;
      min-height: 100vh;
      background: white;
      text-align: center;
      box-shadow: 0 6px 18px var(--color-sombra);
    }

    .header-section {
      padding: 20px 16px 8px;
      background: linear-gradient(to bottom, var(--color-fondo), white 30%);
    }

    .invitation-heading {
      font-size: 14px;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: var(--color-secundario);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .communion-image {
      width: 86%;
      max-width: 320px;
      margin: 6px auto 12px;
      border-radius: 8px;
      box-shadow: 0 6px 18px var(--color-sombra);
      border: 1px solid var(--color-borde);
      display: block;
      object-fit: cover;
    }

    .child-name {
      font-family: 'Parisienne', cursive;
      font-size: 48px;
      color: var(--color-primario);
      margin: 6px 0 10px;
      line-height: 1.1;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    }

    .event-date {
      font-size: 15px;
      text-transform: uppercase;
      font-weight: 500;
      color: var(--color-texto);
      padding: 12px 0;
      border-top: 1px solid var(--color-borde);
      border-bottom: 1px solid var(--color-borde);
      max-width: 90%;
      margin: 20px auto;
      background-color: var(--color-terciario);
      border-radius: 8px;
    }

    .event-card {
      max-width: 92%;
      margin: 14px auto;
      padding: 14px 12px;
      border-top: 1px solid var(--color-borde);
      border-bottom: 1px solid var(--color-borde);
      border-radius: 10px;
      box-shadow: 0 4px 12px var(--color-sombra);
      background-color: white;
      text-align: center; /* homologado: centrado como en Batman template */
    }

    .event-card:first-of-type {
      background-color: var(--color-secundario);
      color: white;
      box-shadow: 0 6px 18px rgba(74,100,166,0.35);
    }

    .event-type {
      font-weight: 600;
      font-size: 14px;
      color: var(--color-primario);
      margin-bottom: 6px;
    }

    .event-time {
      font-size: 14px;
      color: var(--color-texto);
      margin-bottom: 6px;
    }

    .event-location {
      font-style: italic;
      font-size: 13px;
      color: var(--color-texto-claro);
      margin-bottom: 12px;
      line-height: 1.4;
      white-space: pre-line;
      padding: 0 12px;
      text-align: center; /* centrado */
    }

    .map-button, .confirm-button {
      padding: 12px 22px;
      font-size: 15px;
      border-radius: 25px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.18s ease;
      margin: 10px auto;
      display: inline-block;
      min-width: 160px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      text-decoration: none;
      color: white;
    }

    .map-button {
      background-color: var(--color-boton);
    }

    .confirm-button {
      background-color: var(--color-primario);
      margin-bottom: 30px;
    }

    .map-button:hover, .confirm-button:hover {
      background-color: var(--color-boton-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.12);
    }

    /* Modal homologado (Batman template structure) */
    .modal {
      position: fixed; top:0; left:0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.45); z-index:1000;
      opacity:0; pointer-events:none; transition:opacity .25s ease;
    }
    .modal.active { opacity:1; pointer-events:all; }
    .modal-content {
      width:92%; max-width:360px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 28px var(--color-sombra);
      border-top: 4px solid var(--color-primario);
      position: relative;
      transform: translateY(18px);
      transition: transform .25s ease;
    }
    .modal.active .modal-content { transform: translateY(0); }

    .close-modal {
      position:absolute; top:10px; right:10px;
      width:34px; height:34px; border-radius:6px;
      display:flex; align-items:center; justify-content:center;
      background:transparent; border:none; cursor:pointer;
      color:var(--color-primario); font-size:18px; padding:0; z-index:3;
    }

    .modal-title {
      font-family: 'Parisienne', cursive;
      font-size: 22px;
      color: var(--color-primario);
      margin: 0 0 12px;
      text-align: center;
    }

    .form-group { margin-bottom:12px; text-align:left; }
    .form-label { display:block; margin-bottom:6px; font-size:13px; color:var(--color-texto); font-weight:500; }

    .modal-content input[type="text"],
    .modal-content input[type="number"] {
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid var(--color-borde);
      background: var(--color-fondo);
      font-size:14px;
    }

    .modal-content input:focus {
      outline: none;
      box-shadow: 0 0 0 6px var(--focus-ring);
      border-color: var(--color-primario);
    }

    .submit-btn {
      width:100%;
      padding:12px;
      border-radius:20px;
      border:none;
      background: var(--color-primario);
      color:white;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      margin-top:6px;
    }

    .submit-btn[disabled] { opacity:0.6; cursor:not-allowed; transform:none; }

    .loading-spinner {
      display:none;
      width:24px; height:24px; margin:10px auto;
      border:3px solid rgba(10,45,107,0.28);
      border-radius:50%;
      border-top-color: var(--color-primario);
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .success {
      font-family: 'Parisienne', cursive;
      font-size: 22px;
      color: var(--color-primario);
      margin: 12px 0;
      text-align: center;
      display: none;
    }

    footer {
      text-align: center;
      font-size: 12px;
      color: var(--color-texto-claro);
      padding: 12px 0;
      background-color: white;
      border-top: 1px solid var(--color-borde);
    }

    :focus { outline: 3px solid var(--focus-ring); outline-offset: 2px; }

    @media (max-width:420px){
      .modal-content { padding:16px; max-width:320px; }
      .child-name { font-size:40px; }
    }
  </style>
</head>
<body>
  <div class="invitation-container">
    <div class="header-section" role="banner">
      <div class="invitation-heading">Acompáñame a celebrar</div>
      <img class="communion-image" src="https://i.ibb.co/GfwX2YyJ/Chat-GPT-Image-6-ago-2025-06-46-50-p-m.png" alt="Maria Del Carmen" loading="lazy" />
      <div class="child-name">Maria Del Carmen<br/>Ayala Zavala</div>
    </div>

    <div class="content-section" role="main">
      <div class="event-date" aria-label="Fecha del evento">Sábado 18 de Octubre de 2025</div>

      <div class="event-card" aria-labelledby="ceremonia">
        <div id="ceremonia" class="event-type">Ceremonia</div>
        <div class="event-time">12:00 hrs</div>
        <div class="event-location">Parroquia de San Jacinto<br/>Pl. San Jacinto 18 Bis, San Ángel,<br/>CDMX</div>
        <a class="map-button" href="https://maps.app.goo.gl/JA1ufH1kAt35AkPw6" target="_blank" rel="noopener noreferrer">Cómo llegar</a>
      </div>

      <div class="event-card" aria-labelledby="recepcion">
        <div id="recepcion" class="event-type">Recepción</div>
        <div class="event-time">13:30 hrs</div>
        <div class="event-location">Comunidad Teológica de México<br/>Eje 10 Sur 137, Loreto y Campamento<br/>CDMX</div>
        <a class="map-button" href="https://maps.app.goo.gl/YGELYCNmC7Z7vZ1r6" target="_blank" rel="noopener noreferrer">Cómo llegar</a>
      </div>

      <button class="confirm-button" id="openRsvp" aria-haspopup="dialog">Confirma asistencia</button>
    </div>
  </div>

  <!-- Modal homologado -->
  <div id="rsvpModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modalTitle">
    <div class="modal-content" role="document">
      <button class="close-modal" id="closeModalBtn" aria-label="Cerrar">&times;</button>
      <div id="modalTitle" class="modal-title">Confirma tu asistencia</div>

      <form id="rsvpForm" novalidate>
        <div class="form-group">
          <label for="name" class="form-label">Nombre(s) y apellido(s):</label>
          <input id="name" name="name" type="text" autocomplete="name" required />
        </div>

        <div class="form-group">
          <label for="people" class="form-label">Número de personas (máx. 2):</label>
          <input id="people" name="people" type="number" min="1" max="2" value="1" required />
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">Enviar confirmación</button>
        <div class="loading-spinner" id="loadingSpinner" aria-hidden="true"></div>
      </form>

      <div id="thankYouMessage" class="success" aria-live="polite">¡Gracias por confirmar!</div>
    </div>
  </div>

  <footer>
    Versión <strong>1.0.7</strong> — <time id="fechaPublicacion"></time>
  </footer>

  <!-- Firebase compat (defer) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAG1fFh_ZwN4hSYe-1v-yxqsW4WWjyjkl4",
      authDomain: "confirmaciones-jimena.firebaseapp.com",
      projectId: "confirmaciones-jimena",
      storageBucket: "confirmaciones-jimena.appspot.com",
      messagingSenderId: "669569632299",
      appId: "1:669569632299:web:6d64c8d1f476582817826e",
      measurementId: "G-JY78XDX885",
    };

    window.addEventListener('load', () => {
      if (window.firebase && firebase.initializeApp) {
        try { firebase.initializeApp(firebaseConfig); window.db = firebase.firestore(); }
        catch (e) { console.warn('Firebase init:', e); }
      } else {
        console.warn('Firebase no cargó correctamente.');
      }

      // footer fecha/hora al cargar
      document.getElementById('fechaPublicacion').textContent =
        new Date().toLocaleString('es-MX', { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' });
    });

    (function(){
      const openBtn = document.getElementById('openRsvp');
      const modal = document.getElementById('rsvpModal');
      const closeBtn = document.getElementById('closeModalBtn');
      const form = document.getElementById('rsvpForm');
      const submitBtn = document.getElementById('submitBtn');
      const loadingSpinner = document.getElementById('loadingSpinner');
      const thankYou = document.getElementById('thankYouMessage');
      let previousFocus = null;

      function openModal() {
        previousFocus = document.activeElement;
        modal.classList.add('active');
        modal.setAttribute('aria-hidden','false');
        document.body.style.overflow = 'hidden';
        setTimeout(()=> document.getElementById('name')?.focus(), 40);
        document.addEventListener('keydown', handleKey);
      }

      function closeModal() {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        document.removeEventListener('keydown', handleKey);
        setTimeout(() => {
          thankYou.style.display = 'none';
          form.style.display = '';
          form.reset();
          document.getElementById('people').value = 1;
          submitBtn.disabled = false;
          submitBtn.textContent = 'Enviar confirmación';
          loadingSpinner.style.display = 'none';
          if (previousFocus && typeof previousFocus.focus === 'function') previousFocus.focus();
        }, 200);
      }

      function handleKey(e){ if (e.key === 'Escape') closeModal(); }

      modal.addEventListener('click', (e)=> { if (e.target === modal) closeModal(); });
      openBtn.addEventListener('click', (e)=> { e.preventDefault(); openModal(); });
      closeBtn.addEventListener('click', closeModal);

      // Form submit: validations, prevent double submit, save personas + adultos/ninos for panel compatibility
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!window.db) { alert('Base de datos no disponible.'); return; }

        const name = (document.getElementById('name').value || '').trim();
        const personas = Number(document.getElementById('people').value) || 0;

        // validations
        if (!/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s\-']+$/.test(name) || name.length < 3) {
          alert('Por favor ingresa un nombre válido.');
          return;
        }
        if (personas < 1 || personas > 2) {
          alert('Por favor ingresa un número válido de personas (1 o 2).');
          return;
        }

        // UI lock
        submitBtn.disabled = true;
        submitBtn.textContent = 'Enviando...';
        loadingSpinner.style.display = 'block';

        try {
          // save: keep original 'personas' and also save 'adultos' & 'ninos' for panel compatibility
          await db.collection('confirmaciones').add({
            nombre: name,
            personas: personas,
            adultos: personas, // aproximación: todos adultos (panel puede parsear)
            ninos: 0,
            fecha: new Date().toLocaleString('es-MX'),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });

          form.style.display = 'none';
          thankYou.style.display = 'block';
          loadingSpinner.style.display = 'none';

          setTimeout(closeModal, 1400);
        } catch (err) {
          console.error('Error al guardar en Firebase:', err);
          alert('Ocurrió un error al guardar. Intenta nuevamente.');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Enviar confirmación';
          loadingSpinner.style.display = 'none';
        }
      });

      // mobile input helpers
      document.addEventListener('DOMContentLoaded', () => {
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => {
          input.addEventListener('touchstart', (ev) => ev.stopPropagation(), { passive: true });
          input.addEventListener('focus', () => input.scrollIntoView({ behavior:'smooth', block:'center' }));
        });
      });
    })();
  </script>
</body>
</html>
